# AnswerCustomer 系统架构

## 🏗️ 整体架构

```
┌─────────────────────────────────────────────────────────────┐
│                    AnswerCustomer 系统                      │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  ┌─────────────┐    ┌─────────────┐    ┌─────────────┐     │
│  │   管理员    │    │   工程师    │    │   认证      │     │
│  │   模块      │    │   模块      │    │   模块      │     │
│  └─────────────┘    └─────────────┘    └─────────────┘     │
│         │                   │                   │           │
│         └───────────────────┼───────────────────┘           │
│                             │                               │
│  ┌─────────────────────────────────────────────────────┐   │
│  │                Flask Web 应用                       │   │
│  │  ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐  │   │
│  │  │ 路由    │ │ 模板    │ │ 静态    │ │ 工具    │  │   │
│  │  │ 处理    │ │ 引擎    │ │ 文件    │ │ 函数    │  │   │
│  │  └─────────┘ └─────────┘ └─────────┘ └─────────┘  │   │
│  └─────────────────────────────────────────────────────┘   │
│                             │                               │
│  ┌─────────────────────────────────────────────────────┐   │
│  │                数据管理层                           │   │
│  │  ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐  │   │
│  │  │ CSV     │ │ JSON    │ │ 邮件    │ │ 配置    │  │   │
│  │  │ 存储    │ │ 配置    │ │ 服务    │ │ 管理    │  │   │
│  │  └─────────┘ └─────────┘ └─────────┘ └─────────┘  │   │
│  └─────────────────────────────────────────────────────┘   │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

## 🔧 技术架构

### 后端架构
```
Python 3.7+
├── Flask 2.0+ (Web框架)
├── Flask-Login (用户认证)
├── Flask-Bcrypt (密码加密)
├── Jinja2 (模板引擎)
└── Werkzeug (WSGI工具)
```

### 数据存储架构
```
数据层
├── CSV文件存储
│   ├── issues.csv (问题数据)
│   ├── users.csv (用户数据)
│   ├── categories.csv (分类数据)
│   └── comments.csv (评论数据)
├── JSON配置文件
│   └── email_config.json (邮件配置)
└── 数据目录结构
    ├── data/csv/ (CSV文件)
    └── data/config/ (配置文件)
```

### 前端架构
```
用户界面
├── HTML5 (页面结构)
├── CSS3 (样式设计)
├── JavaScript (交互功能)
└── Bootstrap (响应式框架)
```

## 📁 项目结构

```
AnswerCustomer/
├── app/                          # 应用核心
│   ├── __init__.py              # 应用初始化
│   ├── models/                  # 数据模型
│   │   ├── issue.py            # 问题模型
│   │   ├── user.py             # 用户模型
│   │   ├── category.py         # 分类模型
│   │   └── comment.py          # 评论模型
│   ├── routes/                  # 路由处理
│   │   ├── admin.py            # 管理员路由
│   │   ├── engineer.py         # 工程师路由
│   │   ├── auth.py             # 认证路由
│   │   └── main.py             # 主路由
│   ├── templates/               # HTML模板
│   │   ├── admin/              # 管理员页面
│   │   ├── engineer/           # 工程师页面
│   │   ├── auth/               # 认证页面
│   │   └── base.html           # 基础模板
│   ├── static/                 # 静态文件
│   │   ├── css/                # 样式文件
│   │   └── js/                 # JavaScript文件
│   └── utils/                  # 工具函数
│       ├── csv_manager.py      # CSV数据管理
│       ├── config_manager.py   # 配置管理
│       ├── email_notifier.py   # 邮件通知
│       └── category_importer.py # 分类导入
├── data/                       # 数据文件
│   ├── csv/                    # CSV数据
│   └── config/                 # 配置文件
├── tests/                      # 测试文件
├── config.py                   # 系统配置
├── run.py                     # 启动脚本
├── requirements.txt           # 依赖管理
└── 各种启动脚本               # 跨平台启动支持
```

## 🔄 数据流

### 问题处理流程
```
1. 数据导入 → CSV文件 → 问题列表
2. 问题分配 → 工程师 → 处理更新
3. 状态变更 → 评论记录 → 邮件通知
4. 完成处理 → 状态更新 → 数据保存
```

### 邮件通知流程
```
1. 问题导入/更新 → 触发通知
2. 查询邮件配置 → 获取收件人
3. 生成邮件内容 → 发送邮件
4. 更新通知状态 → 记录日志
```

### 用户认证流程
```
1. 用户登录 → 验证凭据
2. 密码验证 → Bcrypt加密
3. 会话管理 → Flask-Login
4. 权限检查 → 路由访问
```

## 🔐 安全架构

### 认证安全
- **密码加密**: Flask-Bcrypt (bcrypt算法)
- **会话管理**: Flask-Login
- **CSRF保护**: 内置CSRF令牌
- **输入验证**: 服务器端验证

### 数据安全
- **文件权限**: 限制数据文件访问
- **数据备份**: 自动备份机制
- **输入过滤**: 防止XSS攻击
- **路径验证**: 防止路径遍历

## 🚀 部署架构

### 开发环境
```
本地开发
├── Python虚拟环境
├── Flask开发服务器
├── 本地数据存储
└── 开发工具集成
```

### 生产环境
```
生产部署
├── WSGI服务器 (Gunicorn/uWSGI)
├── 反向代理 (Nginx)
├── 数据备份
└── 监控日志
```

### 跨平台支持
```
启动方式
├── Windows: .bat/.pyw/.exe
├── macOS: .app/.command/.sh
└── Linux: .sh脚本
```

## 📊 性能优化

### 数据优化
- **CSV缓存**: 减少文件I/O操作
- **分页显示**: 大数据集分页处理
- **索引优化**: 快速数据查询

### 前端优化
- **静态资源**: CSS/JS文件压缩
- **响应式设计**: 多设备适配
- **异步加载**: 提升用户体验

### 系统优化
- **端口管理**: 自动端口检测
- **依赖管理**: 自动化安装
- **错误处理**: 完善的异常处理

## 🔧 扩展性设计

### 模块化架构
- **插件化设计**: 易于功能扩展
- **配置驱动**: 灵活的配置管理
- **API设计**: 支持外部集成

### 数据扩展
- **多格式支持**: 可扩展数据格式
- **数据库迁移**: 支持数据库升级
- **备份恢复**: 数据迁移支持

---

**架构版本**: 1.0  
**更新时间**: 2024-12-19  
**技术栈**: Python + Flask + CSV + Bootstrap 